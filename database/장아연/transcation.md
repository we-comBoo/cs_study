## 트랜잭션

### 정의
하나의 논리적 작업 단위로 필요한 데이터베이스 연산을 모은 것<br>
병행 제어와 회복 작업의 기본 단위임

### 특징 - ACID

1. 원자성 - Atomicity

    트랜잭션은 모두 수행되거나 모두 수행되지 않음을 보장해야 함

2. 일관성 - Consistency

    하나의 트랜잭션 이후 데이터베이스의 상태는 이전과 같이 유효해야 함

3. 격리성 - Isolation

    트랜잭션 수행 중에 다른 트랜잭션의 작업이 끼어들지 못함

4. 영속성 - Durability

    트랜잭션이 성공시 적용된 결과는 영구적으로 지속됨

### 격리성 수준

`Read UnCommitted` <br/>
트랜잭션이 커밋되지 않는 다른 트랜잭션의 변경 내용 읽을 수 있음

`Read Committed`<br/>
트랜잭션이 커밋된 데이터만 읽을 수 있음<br/>
다른 트랜잭션이 커밋되기 전까지는 해당 데이터에 대한 변경 내용을 읽을 수 없음

`Repeatable Read`<br/>
트랜잭션이 시작된 후 다른 트랜잭션이 해당 데이터를 변경하는 것을 막기 위해 본인이 읽은 데이터를 잠궈서 다른 트랜잭션이 수정할 수 없게 만듦

`Serializable`<br/>
모든 데이터를 잠궈서 다른 트랜잭션이 해당 데이터를 접근하는 것을 막음<br/>
이를 통해 동시성 처리 속도는 낮아질 수 있지만, 데이터의 일관성과 무결성을 보장할 수 있음






## 병행 제어
### 병행 수행
여러 사용자가 데이터베이스를 동시 공유할 수 있도록 해 여러개의 트랜젝션을 동시에 수행하는 것

### 정의
병행 수행 시 같은 데이터에 접근해 연산 실행해도 문제가 발생하지 않고 정확한 수행 결과를 얻을 수 있도록 트랜잭션 수행을 제어하는 것

### Locking 기법

1. 기본 원리

    한 트랜잭션이 먼저 접근한 데이터에 대한 연산을 끝낼 때까지 다른 트랜잭션이 그 데이터에 접근하지 못하도록 하는 상호 배제(mutual exclusion)

2. lock과 unlock 연산을 활용한 제어

    `lock` : 트랜잭션이 데이터에 대한 독점권을 요청하는 연산

    `unlock` : 트랜잭션이 데이터에 대한 독점권을 반환하는 연산

3. 기본 locking 규약

* 트랜잭션이 데이터 접근을 위해 lock 연산 실행을 통한 독점권 획득
* 다른 트랜잭션에 의해 lock 연산 실행된 데이터에 다시 lock 연산 실행 불가능
* 독점권 획득한 데이터에 대해 모든 연산 수행 끝나면 트랜잭션은 다시 unlock 연산 실행을 통한 독점권 반환

4. 로킹 단위 - 병행성 - 제어
* 로킹 단위 커짐 - 병행성 작음 - 제어 쉬움
* 로킹 단위 작음 - 병행성 큼 - 제어 어려움

5. 기본 locking 규약 효율성 높이기

    트랜잭션이 데이터에 대해 `공용 lock` 연산 실행
    * read 연산 실행 가능
    * write 연산 실행 가능
    * 다른 트랜잭션도 공용 lock 연산 동시에 실행 가능
<br/>
<br/>

    트랜잭션이 데이터에 대해 `전용 lock` 연산 실행
    * read 연산 실행 가능
    * write 연산 실행 가능
    * 다른 트랜잭션도 어떠한 lock 연산 (전용/공용) 모두 실행 불가능

    <br/>
        Lock 연산의 양립성


    ![Alt text](./img/image-2.png)


## 교착상태

### 정의
트랜잭션들이 상대가 독점하고 있는 데이터에 unlock 연산이 실행되기를 서로 기다리면서 트랜잭션 수행을 중단하고 있는 상태

